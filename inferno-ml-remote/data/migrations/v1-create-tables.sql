CREATE EXTENSION lo;

CREATE TABLE IF NOT EXISTS users(
  id TEXT PRIMARY KEY
);

CREATE TABLE IF NOT EXISTS params(
  id SERIAL PRIMARY KEY,
  script TEXT NOT NULL,
  "user" TEXT REFERENCES users (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS models(
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  contents OID NOT NULL,
  version TEXT NOT NULL,
  "user" TEXT REFERENCES users (id) ON DELETE CASCADE
);

CREATE TRIGGER "manage-model-lo" BEFORE UPDATE OR DELETE ON models
  FOR EACH ROW EXECUTE FUNCTION lo_manage(contents);
